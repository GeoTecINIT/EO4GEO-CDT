<div class="animated fadeIn">
  <div class="row">
    <div class="col-sm-12 col-md-12">
      <div class="card card-accent-primary">
        <div class="card-header">
          <div class="row">
            <div class="col-sm-4 col-md-2">
              Detail
            </div>
            <div class="col-sm-4 offset-md-4 col-md-4"></div>
            <div class="col-sm-4 col-md-2">
              <div *ngIf="currentTreeNode; else loading" class="row">
                <div class="cols-xs-2 col-md-3">
                  <button type="button" class="btn btn-block btn-link" [popover]="popTemplate" tooltip="Share"
                    popoverTitle="Copy link, export to PDF or XML" placement="top" [outsideClick]="true">
                    <i class="fa fa-share-alt fa-lg"></i>
                  </button>
                </div>
                <div class="cols-xs-2 col-md-3">
                  <button type="button" class="btn btn-block btn-link" tooltip="Duplicate"
                    routerLink="/newsp/duplicate/{{ selectedProgram._id }}">
                    <i class="fa fa-copy fa-lg"></i>
                  </button>
                </div>
                <div class="cols-xs-2 col-md-3">
                  <button type="button" class="btn btn-block btn-link" tooltip="Edit"
                    routerLink="/newsp/copy/{{ selectedProgram._id }}">
                    <i class="fa fa-edit fa-lg"></i>
                  </button>
                </div>
                <div class="cols-xs-2 col-md-3">
                  <button type="button" class="btn btn-block btn-link" tooltip="Remove" data-toggle="modal"
                    (click)="dangerModal.show()">
                    <i class="fa fa-trash-o fa-lg"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="card-body" [hidden]="currentTreeNode == null">
          <ng-container>
            <!--  *ngIf="selectedProgram; else loading" -->
            <div class="row" *ngIf="selectedProgram; else loading">
              <div class="col-md-6">
                <h1>{{ selectedProgram.name }}</h1>
                <h5>{{ selectedProgram.affiliation }} </h5>
              </div>
              <div class="col-md-2 offset-md-3" *ngIf="selectedProgram.field">
                <h5>{{ selectedProgram.field.name }} ({{ selectedProgram.field.grandparent }})</h5>
              </div>
              <div class="col-md-1">
                <button type="button" class="btn btn-default btn-secondary"
                  tooltip="The threshold of knowledge by which a person is capable to understand the information given in a certain domain."
                  placement="left" (click)="displayTree()">
                  EQF: {{ selectedProgram.eqf }}
                </button>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6" #graphTreeDiv (click)="refreshCurrentNode()">
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    <label>General view</label>
                    <span tooltip="Click on any node to see more information about the module, course or lecture."
                      class="badge badge-primary badge-pill">i</span>
                    <button class="btn btn-link float-right pull-right"
                      (click)="graphTreeDiv.classList.contains('col-md-12') ? graphTreeDiv.className = 'col-md-6' : graphTreeDiv.className = 'col-md-12'; refreshTreeSize()">
                      <!--    [ngClass]="'active' : shown == 'EQUIFAX'" (click)="shown = 'EQUIFAX'" type="button" id="equifax" class="btn btn-secondary" -->
                      <i class="float-right pull-right fa "
                        [ngClass]="{'fa-window-minimize': graphTreeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': graphTreeDiv?.classList.contains('col-md-6')}"></i>
                    </button>
                    <div id="graphTree"></div>
                  </div>
                </div>
              </div>
              <div class="col-md-6" *ngIf="model; else loading" #graphTextDiv>
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    <label>Info</label>
                    <span tooltip="Click on any node to see more information about the module, course or lecture."
                      class="badge badge-primary badge-pill">i</span>
                    <button class="btn btn-link float-right pull-right"
                      (click)="graphTextDiv.classList.contains('col-md-12') ? graphTextDiv.className = 'col-md-6' : graphTextDiv.className = 'col-md-12'">
                      <i class="float-right pull-right fa "
                        [ngClass]="{'fa-window-minimize': graphTextDiv?.classList.contains('col-md-12'), 'fa-window-maximize': graphTextDiv?.classList.contains('col-md-6')}"></i>
                    </button>
                    <div *ngIf="currentTreeNode">
                      <div *ngIf="currentTreeNode.depth == 0">
                        <h4> Study Program: {{ model.name }} </h4> <!-- Study Program -->
                        <p><b>Affiliation:</b> {{ model.affiliation }}</p>
                        <p class="text-justify">{{ model.description }}</p>
                        <p><b>EQF Level:</b> {{ model.eqf }}</p>
                        <div *ngIf="model.field"> <p><b>Field:</b> {{ model.field.name }} ({{ model.field.grandparent }})</p> </div>
                        <p><b>Number of semesters:</b> {{ model.numSemesters }}</p>
                      </div>
                      <div *ngIf="currentTreeNode.depth == 1">
                        <!-- Module -->
                        <h4> Module: {{ model.name }} </h4>
                        <p class="text-justify">{{ model.description }}</p>
                      </div>
                      <div *ngIf="currentTreeNode.depth == 2">
                        <!-- Course -->
                        <h4> Course: {{ model.name }} </h4>
                        <p class="text-justify">{{ model.description }}</p>
                      </div>
                      <div *ngIf="currentTreeNode.depth == 3">
                        <!-- Lecture -->
                        <h4> Lecture: {{ model.name }} </h4>
                        <p class="text-justify">{{ model.description }}</p>
                        <p><b>Is practical:</b> {{ model.isPractical }}</p>
                      </div>
                      <!-- Common attributes -->
                      <div *ngIf="model.numSemester">
                        <p><b> In semester:</b> {{ model.numSemester }}</p>
                      </div>
                      <div *ngIf="model.ects">
                        <p><b> ECTS:</b> {{ model.ects }}</p>
                      </div>
                      <div *ngIf="model.assessment">
                        <p><b>Assessment:</b> {{ model.assessment }}</p>
                      </div>
                      <div *ngIf="model.bibliography">
                        <p><b>Bibliography:</b> {{ model.bibliography }}</p>
                      </div>
                      <div *ngIf="model.sourceDocs">
                        <p><b>Bibliography:</b> {{ model.sourceDocs }}</p>
                      </div>
                      <div *ngIf="model.prerequisites && model.prerequisites.length > 0">
                        <span><b>Prerequisites</b></span>
                        <ul>
                          <div *ngFor="let p of model.prerequisites">
                            <li>{{ p.name }}</li>
                          </div>
                        </ul>
                      </div>
                      <div *ngIf="model.learningObjectives && model.learningObjectives.length > 0">
                        <span><b>Learning Objectives:</b></span>
                        <ul>
                          <div *ngFor="let l of model.learningObjectives">
                            <li>{{ l.name }}</li>
                          </div>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
        <ng-template #loading>
          <app-loading-indicator></app-loading-indicator>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<ng-template #popTemplate>
  <app-popup idOP="{{selectedProgram._id}}"></app-popup>
</ng-template>
<div bsModal #dangerModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-danger" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Are you sure you want to delete this Study Program?</h4>
        <button type="button" class="close" (click)="dangerModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>After you delete it it won't be accessible to anyone.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="dangerModal.hide()">Close</button>
        <button type="button" class="btn btn-danger"
          (click)="studyprogramService.removeStudyProgram(selectedProgram._id)" routerLink="/list">Delete</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->