<div class="animated fadeIn">
  <h1 class="title">{{ title }}</h1>
  <div class="row">
    <div class="col-sm-12 col-md-12">
      <div class="card card-accent-primary">
        <div class="card-header">
          <div class="row">
            <div class="col-md-8 text-center">
              <!--              <button type="submit" class="btn btn-pill btn-primary" (click)="addNodeInTree(1)"
                [disabled]="currentTreeNode.depth == 3">
                <i class="fa fa-plus"></i> Create new {{textByDepth}}
              </button> -->

              <div class="btn-group" dropdown>
                <button id="button-animated" dropdownToggle type="button"
                  class="btn btn-pill btn-primary dropdown-toggle" aria-controls="dropdown-animated">
                  <i class="fa fa-plus"></i> Create new <span class="caret"></span>
                </button>
                <ul id="dropdown-animated" *dropdownMenu class="dropdown-menu" role="menu"
                  aria-labelledby="button-animated">
                  <li role="menuitem"><a class="dropdown-item pt-2 pb-2"
                      [ngClass]="{'disabled': currentTreeNode && currentTreeNode.data.depth>=0}" (click)="addNodeInTree(0)">Study
                      Program</a></li>
                  <li role="menuitem"><a class="dropdown-item pt-2 pb-2"
                      [ngClass]="{'disabled': currentTreeNode && currentTreeNode.data.depth>=1}" (click)="addNodeInTree(1)">Module</a></li>
                  <li role="menuitem"><a class="dropdown-item pt-2 pb-2"
                      [ngClass]="{'disabled': currentTreeNode && currentTreeNode.data.depth>=2}" (click)="addNodeInTree(2)">Course</a></li>
                  <li role="menuitem"><a class="dropdown-item pt-2 pb-2"
                      [ngClass]="{'disabled': currentTreeNode && currentTreeNode.data.depth>=3}" (click)="addNodeInTree(3)">Lecture</a>
                  </li>
                </ul>
              </div>

              <button type="submit" class="btn btn-pill btn-primary"
                (click)="isSearchingExisting = !isSearchingExisting" [disabled]="currentTreeNode && currentTreeNode.data.depth == 3">
                <i class="fa fa-search"></i> Explore existing {{textByDepth}}s
              </button>
              <button type="submit" class="btn btn-pill btn-danger" (click)="removeNodeInTree()"> 
                <!-- [disabled]="currentTreeNode.data.depth == 0" -->
                <i class="fa fa-minus"></i> Remove {{textByDepthRemove}}
              </button>
            </div>
            <div class="col-md-2" style="display: inline-flex">
              <span class="input-group-prepend">
                <div class="pr-1"> Visibility: Private </div>
                <label class="switch switch-label switch-pill switch-outline-primary-alt">
                  <input class="switch-input" type="checkbox" value="knowledges"
                    [(ngModel)]="model && model.levelPublic" />
                  <span class="switch-slider" data-checked="✓" data-unchecked="X"></span>
                </label>
                <div class="pl-1">Public </div>
              </span>
            </div>
            <div class="col-md-2 text-right">
              <button type="submit" class="btn btn-pill btn-primary" (click)="saveStudyProgram()" routerLink="/list">
                <i class="fa fa-save"></i> Save
              </button>
            </div>
          </div>
        </div>
        <!-- card body -->
        <div class="card-body">
          <div class="row" (window:resize)="onResize()">
            <div class="col-md-6" #graphTreeDiv (click)="refreshCurrentNode()">
              <div class="card card-accent-secondary">
                <div class="card-header">
                  <label>General view</label>
                  <span tooltip="Click on any node to see more information about the module, course or lecture."
                    class="badge badge-primary badge-pill">i</span>
                  <button class="btn btn-link float-right pull-right"
                    (click)="graphTreeDiv.classList.contains('col-md-12') ? graphTreeDiv.className = 'col-md-6' : graphTreeDiv.className = 'col-md-12'; refreshTreeSize()">
                    <i class="float-right pull-right fa "
                      [ngClass]="{'fa-window-minimize': graphTreeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': graphTreeDiv?.classList.contains('col-md-6')}"></i>
                  </button>
                  <div id="graphTree"></div>
                </div>
              </div>
            </div>
            <div *ngIf="currentTreeNode && (model || modelModule || modelCourse || modelLecture)" class="col-md-6" #NodeDiv>
              <!-- depth = 0 -> general info card -->
              <div *ngIf="!isSearchingExisting && currentTreeNode.data.depth == 0">
                <form #newOPForm="ngForm">
                  <div class="card card-accent-secondary">
                    <div class="card-header">
                      Study Program Information
                      <span tooltip="" class="badge badge-primary badge-pill">i</span>
                      <button class="btn btn-link float-right pull-right"
                        (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                        <i class="float-right pull-right fa "
                          [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                      </button>
                    </div>
                    <div class="card-body" style="background-color: #faf9f8">
                      <div class="row">
                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="title">Title</label>
                            <input type="text" class="form-control" id="title" placeholder="Title"
                              [(ngModel)]="model.name" name="title" required (keyup)="updateTreeStudyProgram()" />
                            <div *ngIf="model.linksToBok.length > 0" style="display: flex;">
                              <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                              <div *ngFor="let l of model.linksToBok; index as i ">
                                <p class="text-small" *ngIf="l.linkedTo=='name'">{{l.concept_id }} <button type="button"
                                    class="btn btn-link btn-xs" (click)="removeBokKnowledge(model, i, 'linksToBok')">
                                    <i class="fa fa-remove"></i>
                                  </button></p>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-2 align-middle m-auto">
                          <button type="button" class="btn btn-primary btn-sm"
                            (click)="bokModal.show(); linkBoKto='name'">
                            Link BoK title
                          </button>
                        </div>

                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="title">Affiliation</label>
                            <input type="text" class="form-control" id="affiliation" placeholder="Affiliation"
                              [(ngModel)]="model.affiliation" name="affiliation" required
                              (keyup)="updateTreeStudyProgram()" />
                          </div>
                        </div>
                        <div class="col-md-2">
                          <div class="form-group">
                            <label for="eqf">EQF</label>
                            <span
                              tooltip="The core of the EQF concerns eight reference levels describing what a learner knows, understands and is able to do – 'learning outcomes', ranging from basic (Level 1) to advanced (Level 8)."
                              class="badge badge-primary badge-pill">i</span>
                            <input type="number" size="1" class="form-control" id="eqf" [(ngModel)]="model.eqf"
                              name="eqf" min="1" max="8" (keyup)="updateTreeStudyProgram()" />
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="field">Field</label>
                            <span
                              tooltip="The term relates directly to a specific area of study. The International Standard Classification of Education: Fields of Education and Training 2013 (ISCED-F). Maintained by the UNESCO Institute for Statistics."
                              class="badge badge-primary badge-pill">i</span>
                            <ng-select [items]="fieldsService.allfields" name="field" bindLabel="name"
                              groupBy="grandparent" [multiple]="false" [(ngModel)]="model.field">
                              <ng-template ng-optgroup-tmp let-item="item">
                                {{item.grandparent || 'Unnamed group'}}
                              </ng-template>
                            </ng-select>
                          </div>
                        </div>
                        <div class="col-md-2">
                          <div class="form-group">
                            <label for="field">Amount of semesters</label>
                            <span tooltip="Number of semesters in the curricula."
                              class="badge badge-primary badge-pill">i</span>
                            <input type="number" size="1" class="form-control" id="numSemesters"
                              [(ngModel)]="model.numSemesters" name="numSemesters" min="1" max="20"
                              (keyup)="updateTreeStudyProgram()" />
                          </div>
                        </div>

                      </div>
                      <div class="row">
                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="description">Description</label>
                            <textarea class="form-control" id="description" placeholder="Description" name="description"
                              [(ngModel)]="model.description" rows="4" (keyup)="updateTreeStudyProgram()"></textarea>
                            <div *ngIf="model.linksToBok.length > 0" style="display: flex;">
                              <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                              <div *ngFor="let l of model.linksToBok; index as i ">
                                <p class="text-small" *ngIf="l.linkedTo=='description'">{{l.concept_id }} <button
                                    type="button" class="btn btn-link btn-xs"
                                    (click)="removeBokKnowledge(model, i, 'linksToBok')">
                                    <i class="fa fa-remove"></i>
                                  </button></p>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-2 align-middle m-auto">
                          <button type="button" class="btn btn-primary btn-sm"
                            (click)="bokModal.show(); linkBoKto='description'">
                            Link BoK description
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
              <!-- depth = 1 -> Modules -->
              <div *ngIf="!isSearchingExisting && currentTreeNode.data.depth == 1">
                <form #newOPForm="ngForm">
                  <div class="card card-accent-secondary">
                    <div class="card-header">
                      Module Information
                      <span tooltip="" class="badge badge-primary badge-pill">i</span>
                      <button class="btn btn-link float-right pull-right"
                        (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                        <i class="float-right pull-right fa "
                          [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                      </button>
                    </div>
                    <div class="card-body" style="background-color: #faf9f8">
                      <div class="row">
                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="title">Title</label>
                            <input type="text" class="form-control" id="title" placeholder="Title"
                              [(ngModel)]="modelModule.name" name="title" required (keyup)="updateTreeStudyProgram()" />
                            <div *ngIf="modelModule.linksToBok.length > 0" style="display: flex;">
                              <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                              <div *ngFor="let l of modelModule.linksToBok; index as i ">
                                <p class="text-small" *ngIf="l.linkedTo=='name'">{{l.concept_id }} <button type="button"
                                    class="btn btn-link btn-xs"
                                    (click)="removeBokKnowledge(modelModule, i, 'linksToBok')">
                                    <i class="fa fa-remove"></i>
                                  </button></p>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-2 align-middle m-auto">
                          <button type="button" class="btn btn-primary btn-sm"
                            (click)="bokModal.show(); linkBoKto='name'">
                            Link BoK title
                          </button>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="numSemester">Number of semester</label>
                            <span tooltip="In which semester is taught." class="badge badge-primary badge-pill">i</span>
                            <input type="number" size="1" class="form-control" id="numSemester"
                              [(ngModel)]="modelModule.numSemester" name="numSemester" min="1" max="15"
                              (keyup)="updateTreeStudyProgram()" />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="ects">ECTS</label>
                            <span tooltip="" class="badge badge-primary badge-pill">i</span>
                            <input type="number" size="1" class="form-control" id="ects" [(ngModel)]="modelModule.ects"
                              name="ects" min="1" max="20" (keyup)="updateTreeStudyProgram()" />
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="description">Description</label>
                            <textarea class="form-control" id="description" placeholder="Description" name="description"
                              [(ngModel)]="modelModule.description" rows="4"
                              (keyup)="updateTreeStudyProgram()"></textarea>
                            <div *ngIf="modelModule.linksToBok.length > 0" style="display: flex;">
                              <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                              <div *ngFor="let l of modelModule.linksToBok; index as i ">
                                <p class="text-small" *ngIf="l.linkedTo=='description'">{{l.concept_id }} <button
                                    type="button" class="btn btn-link btn-xs"
                                    (click)="removeBokKnowledge(modelModule, i, 'linksToBok')">
                                    <i class="fa fa-remove"></i>
                                  </button></p>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-2 align-middle m-auto">
                          <button type="button" class="btn btn-primary btn-sm"
                            (click)="bokModal.show(); linkBoKto='description'">
                            Link BoK description
                          </button>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="prerequisites">Prerequisites</label>
                            <div class="col-md-12">
                              <div *ngIf="modelModule && modelModule.prerequisites">
                                <ul>
                                  <div *ngFor="let p of modelModule.prerequisites; index as i ">
                                    <li>{{p.concept_id}} <button type="button" class="btn btn-link"
                                        (click)="removeBokKnowledge(modelModule, i, 'prerequisites')">
                                        <i class="fa fa-remove"></i>
                                      </button></li>
                                  </div>
                                </ul>
                              </div>
                              <div *ngIf="!modelModule.prerequisites || modelModule.prerequisites.length == 0"
                                class="text-placeholder">
                                Explore the Body of Knowledge to add some.
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-2 align-middle m-auto">
                          <button type="button" class="btn btn-primary btn-sm"
                            (click)="bokModal.show(); linkBoKto='prerequisites'">
                            Link BoK prerequisite
                          </button>
                        </div>
                        <!--     <div class="col-md-12 align-middle m-auto">
                        <div *ngIf="modelModule.linksToBok.length" style="display: flex;">
                          <div *ngFor="let l of modelModule.linksToBok; index as i ">
                            <p class="text-small" *ngIf="l.linkedTo=='prerequisites'">{{l.concept_id }} <button
                                type="button" class="btn btn-link btn-sm"
                                (click)="removeBokKnowledge(modelModule, i, 'linksToBok')">
                                <i class="fa fa-remove"></i>
                              </button></p>
                          </div>
                        </div>
                      </div> -->
                      </div>
                      <div class="row">
                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="title">Learning Outcomes</label>
                            <div class="row">
                              <div class="col-md-12">
                                <div *ngIf="modelModule && modelModule.learningObjectives">
                                  <ul>
                                    <div *ngFor="let p of modelModule.learningObjectives; index as i ">
                                      <li>{{p.name}}
                                        <!-- <button type="button" class="btn btn-link"
                                        (click)="removeBokKnowledge(modelModule, i, 'learningObjectives')">
                                        <i class="fa fa-remove"></i>
                                      </button> -->
                                      </li>
                                    </div>
                                  </ul>
                                </div>
                                <div
                                  *ngIf="!modelModule.learningObjectives || modelModule.learningObjectives.length == 0"
                                  class="text-placeholder">
                                  Add some courses and explore BoK to add some.
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-2 align-middle m-auto">
                          <button type="button" class="btn btn-primary btn-sm" disabled>
                            Inherited from child courses
                          </button>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-12">
                          <div class="form-group">
                            <label for="assessment">Assessment</label>
                            <textarea class="form-control" id="assessment" placeholder="Assessment" name="assesment"
                              [(ngModel)]="modelModule.assessment" rows="4"
                              (keyup)="updateTreeStudyProgram()"></textarea>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
              <!-- depth = 2 -> Course -->
              <div *ngIf="!isSearchingExisting && currentTreeNode.data.depth == 2">
                <form #newOPForm="ngForm">
                  <div class="card card-accent-secondary">
                    <div class="card-header">
                      Course Information
                      <span tooltip="" class="badge badge-primary badge-pill">i</span>
                      <button class="btn btn-link float-right pull-right"
                        (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                        <i class="float-right pull-right fa "
                          [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                      </button>
                    </div>
                    <div class="card-body" style="background-color: #faf9f8">
                      <div class="row">
                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="title">Title</label>
                            <input type="text" class="form-control" id="title" placeholder="Title"
                              [(ngModel)]="modelCourse.name" name="title" required (keyup)="updateTreeStudyProgram()" />
                            <div *ngIf="modelCourse.linksToBok.length > 0" style="display: flex;">
                              <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                              <div *ngFor="let l of modelCourse.linksToBok; index as i ">
                                <p class="text-small" *ngIf="l.linkedTo=='name'">{{l.concept_id }} <button type="button"
                                    class="btn btn-link btn-xs"
                                    (click)="removeBokKnowledge(modelCourse, i, 'linksToBok')">
                                    <i class="fa fa-remove"></i>
                                  </button></p>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-2 align-middle m-auto">
                          <button type="button" class="btn btn-primary btn-sm"
                            (click)="bokModal.show(); linkBoKto='name'">
                            Link BoK title
                          </button>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="description">Description</label>
                            <textarea class="form-control" id="description" placeholder="Description" name="description"
                              [(ngModel)]="modelCourse.description" (keyup)="updateTreeStudyProgram()"
                              rows="4"></textarea>
                            <div *ngIf="modelCourse.linksToBok.length > 0" style="display: flex;">
                              <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                              <div *ngFor="let l of modelCourse.linksToBok; index as i ">
                                <p class="text-small" *ngIf="l.linkedTo=='description'">{{l.concept_id }} <button
                                    type="button" class="btn btn-link btn-xs"
                                    (click)="removeBokKnowledge(modelCourse, i, 'linksToBok')">
                                    <i class="fa fa-remove"></i>
                                  </button></p>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-2 align-middle m-auto">
                          <button type="button" class="btn btn-primary btn-sm"
                            (click)="bokModal.show(); linkBoKto='description'">
                            Link BoK description
                          </button>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="title">Prerequisites</label>
                            <div class="row">
                              <div class="col-md-12">
                                <div *ngIf="modelCourse && modelCourse.prerequisites">
                                  <ul>
                                    <div *ngFor="let p of modelCourse.prerequisites; index as i ">
                                      <li>{{p.concept_id}} <button type="button" class="btn btn-link"
                                          (click)="removeBokKnowledge(modelCourse, i, 'prerequisites')">
                                          <i class="fa fa-remove"></i>
                                        </button></li>
                                    </div>
                                  </ul>
                                </div>
                                <div *ngIf="!modelCourse.prerequisites || modelCourse.prerequisites.length == 0"
                                  class="text-placeholder">
                                  Explore the Body of Knowledge to add some.
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-2 align-middle m-auto">
                          <button type="button" class="btn btn-primary btn-sm"
                            (click)="bokModal.show(); linkBoKto='prerequisites'">
                            Link BoK prerequisite
                          </button>
                        </div>
                        <!-- <div *ngFor="let l of modelCourse.linksToBok; index as i ">
                        <p class="text-small" *ngIf="l.linkedTo=='prerequisites'">{{l.concept_id }} <button
                            type="button" class="btn btn-link btn-sm"
                            (click)="removeBokKnowledge(modelCourse, i, 'linksToBok')">
                            <i class="fa fa-remove"></i>
                          </button></p>
                      </div> -->
                      </div>
                      <div class="row">
                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="title">Learning Outcomes</label>
                            <div class="row">
                              <div class="col-md-12">
                                <div *ngIf="modelCourse && modelCourse.learningObjectives">
                                  <ul>
                                    <div *ngFor="let p of modelCourse.learningObjectives; index as i ">
                                      <li>{{p.name}} <button type="button" class="btn btn-link"
                                          (click)="removeBokKnowledge(modelCourse, i, 'learningObjectives')">
                                          <i class="fa fa-remove"></i>
                                        </button></li>
                                    </div>
                                  </ul>
                                </div>
                                <div
                                  *ngIf="!modelCourse.learningObjectives || modelCourse.learningObjectives.length == 0"
                                  class="text-placeholder">
                                  Explore the Body of Knowledge to add some or add custom learning outcomes.
                                </div>
                                <div *ngIf="modelCourse.linksToBok.length > 0" style="display: flex;">
                                  <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                                  <div *ngFor="let l of modelCourse.linksToBok; index as i ">
                                    <p class="text-small" *ngIf="l.linkedTo=='learningObjectives'">{{l.concept_id }}
                                      <button type="button" class="btn btn-link btn-xs"
                                        (click)="removeBokKnowledge(modelCourse, i, 'linksToBok')">
                                        <i class="fa fa-remove"></i>
                                      </button></p>
                                  </div>
                                </div>
                                <br>
                                <div class="row">
                                  <div class="col-md-2"></div>
                                  <div class="col-md-6">
                                    <input type="text" class="form-control" id="customLO"
                                      placeholder="Add custom learning outcome" [(ngModel)]="customLO"
                                      name="customLO" />
                                  </div>
                                  <div class="col-md-4">
                                    <button type="button" class="btn btn-primary btn-sm" (click)="addCustomLO()">
                                      Add custom LO
                                    </button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-2 align-middle m-auto">
                          <button type="button" class="btn btn-primary btn-sm"
                            (click)="bokModal.show(); linkBoKto='learningObjectives'">
                            Link BoK learning outcomes
                          </button>
                        </div>
                        <!--      <div *ngFor="let l of modelCourse.linksToBok; index as i ">
                        <p class="text-small" *ngIf="l.linkedTo=='learningObjectives'">{{l.concept_id }} <button
                            type="button" class="btn btn-link btn-sm"
                            (click)="removeBokKnowledge(modelCourse, i, 'linksToBok')">
                            <i class="fa fa-remove"></i>
                          </button></p>
                      </div> -->
                      </div>
                      <div class="row">
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="ects">ECTS/CP</label>
                            <span tooltip="" class="badge badge-primary badge-pill">i</span>
                            <input type="number" size="3" class="form-control" name="ects" id="ects"
                              [(ngModel)]="modelCourse.ects" name="ects" min="1" max="999"
                              (keyup)="updateTreeStudyProgram()" />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="numSemester">Number of semester</label>
                            <span tooltip="In which semester is taught." class="badge badge-primary badge-pill">i</span>
                            <input type="number" size="3" class="form-control" id="numSemester"
                              [(ngModel)]="modelCourse.numSemester" name="numSemester" min="1" max="999"
                              (keyup)="updateTreeStudyProgram()" />
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-12">
                          <div class="form-group">
                            <label for="assessment">Assessment</label>
                            <span tooltip="" class="badge badge-primary badge-pill">i</span>
                            <input type="text" class="form-control" id="assessment" placeholder="Assessment"
                              [(ngModel)]="modelCourse.assessment" name="assessment"
                              (keyup)="updateTreeStudyProgram()" />
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-12">
                          <div class="form-group">
                            <label for="bibliography">Bibliography</label>
                            <span tooltip="" class="badge badge-primary badge-pill">i</span>
                            <input type="text" class="form-control" id="bibliography" placeholder="Bibliography"
                              [(ngModel)]="modelCourse.bibliography" name="bibliography"
                              (keyup)="updateTreeStudyProgram()" />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
              <!-- depth = 3 -> Lectures -->
              <div *ngIf="!isSearchingExisting && currentTreeNode.data.depth == 3">
                <form #newOPForm="ngForm">
                  <div class="card card-accent-secondary">
                    <div class="card-header">
                      Lecture Information
                      <span tooltip="" class="badge badge-primary badge-pill">i</span>
                      <button class="btn btn-link float-right pull-right"
                        (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                        <i class="float-right pull-right fa "
                          [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                      </button>
                    </div>
                    <div class="card-body" style="background-color: #faf9f8">
                      <div class="row">
                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="title">Title</label>
                            <input type="text" class="form-control" id="title" placeholder="Title"
                              [(ngModel)]="modelLecture.name" name="title" required
                              (keyup)="updateTreeStudyProgram()" />
                            <div *ngIf="modelLecture.linksToBok.length > 0" style="display: flex;">
                              <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                              <div *ngFor="let l of modelLecture.linksToBok; index as i ">
                                <p class="text-small" *ngIf="l.linkedTo=='name'">{{l.concept_id }} <button type="button"
                                    class="btn btn-link btn-xs"
                                    (click)="removeBokKnowledge(modelLecture, i, 'linksToBok')">
                                    <i class="fa fa-remove"></i>
                                  </button></p>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-2 align-middle m-auto">
                          <button type="button" class="btn btn-primary btn-sm"
                            (click)="bokModal.show(); linkBoKto='name'">
                            Link BoK title
                          </button>
                        </div>

                      </div>
                      <div class="row">
                        <div class="col-md-10">
                          <div class="form-group">
                            <label for="description">Description</label>
                            <textarea class="form-control" id="description" placeholder="Description" name="description"
                              [(ngModel)]="modelLecture.description" rows="4"
                              (keyup)="updateTreeStudyProgram()"></textarea>
                            <div *ngIf="modelLecture.linksToBok.length > 0" style="display: flex;">
                              <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                              <div *ngFor="let l of modelLecture.linksToBok; index as i ">
                                <p class="text-small" *ngIf="l.linkedTo=='description'">{{l.concept_id }} <button
                                    type="button" class="btn btn-link btn-xs"
                                    (click)="removeBokKnowledge(modelLecture, i, 'linksToBok')">
                                    <i class="fa fa-remove"></i>
                                  </button></p>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-2 align-middle m-auto">
                          <button type="button" class="btn btn-primary btn-sm"
                            (click)="bokModal.show(); linkBoKto='description'">
                            Link BoK description
                          </button>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="ects">ECTS/CP</label>
                            <span tooltip="" class="badge badge-primary badge-pill">i</span>
                            <input type="number" size="3" class="form-control" id="ects" [(ngModel)]="modelLecture.ects"
                              name="ects" min="1" max="999" (keyup)="updateTreeStudyProgram()" />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="isPractical">Is practical</label>
                            <span tooltip="Check this option if it is a practical lecture."
                              class="badge badge-primary badge-pill">i</span>
                            <label class="switch switch-pill switch-primary">
                              <input type="checkbox" name="isPractical" class="switch-input"
                                [(ngModel)]="modelLecture.isPractical">
                              <span class="switch-slider"></span>
                            </label>
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-md-12">
                          <div class="form-group">
                            <label for="bibliography">Bibliography</label>
                            <span tooltip="" class="badge badge-primary badge-pill">i</span>
                            <input type="text" class="form-control" id="bibliography" placeholder="Bibliography"
                              [(ngModel)]="modelLecture.bibliography" name="bibliography"
                              (keyup)="updateTreeStudyProgram()" />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>

              <!-- Existing modules, courses and lectures -->
              <div *ngIf="isSearchingExisting" #ExNodeDiv>
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    Explore existing {{textByDepth}}s
                    <span
                      tooltip="These modules have been added by other user, and can be re-used in your study program."
                      class="badge badge-primary badge-pill">i</span>
                    <button class="btn btn-link float-right pull-right"
                      (click)="ExNodeDiv.classList.contains('col-md-12') ? ExNodeDiv.className = 'col-md-6' : ExNodeDiv.className = 'col-md-12'">
                      <i class="float-right pull-right fa "
                        [ngClass]="{'fa-window-minimize': ExNodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': ExNodeDiv?.classList.contains('col-md-6')}"></i>
                    </button>
                  </div>
                  <div class="card-body" style="background-color: #faf9f8">
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="title">Filter {{textByDepth}} by name</label>
                          <input type="text" class="form-control" id="filterText" placeholder="Type to filter"
                            [(ngModel)]="filterText" name="filterText" />
                        </div>
                      </div>
                      <!-- <div class="col-md-6">
                      <div class="form-group">
                        <label for="title">Filter {{textByDepth}} by affiliation</label>
                        <input type="text" class="form-control" id="filterTextAff" placeholder="Type to filter"
                          [(ngModel)]="filterTextAff" name="filterTextAff" />
                      </div>
                    </div> -->
                    </div>
                    <ul *ngIf="currentTreeNode.data.depth == 0">
                      <div *ngFor="let sp of allStudyPrograms; index as i">
                        <div *ngFor="let m of (sp.children | filter:filterText); index as j">
                          <li>
                            <h5 class="card-title">{{ m.name }}</h5>
                            <h6 class="text-muted inline">{{ m.numSemester }} semester</h6>
                            <h6 class="text-muted inline"> - {{ sp.affiliation }}</h6>
                            <a (click)="addExistingToStudyProgram(m)" class="inline">Add</a>
                            <div *ngIf="!(showMoreIndexM == j && showMoreIndexSP == i)">
                              <a (click)="showMoreIndexM = j; showMoreIndexSP = i" class="inline">Show more...</a>
                            </div>
                            <div *ngIf="showMoreIndexM == j && showMoreIndexSP == i">
                              <a (click)="showMoreIndexM = -1; showMoreIndexSP = -1" class="inline">Show less...</a>
                              <p class="card-text">{{ m.description }}</p>
                              <div *ngIf="m.children.length > 0">
                                <b>Child nodes that will also be included:</b>
                                <div *ngFor="let c of m.children" style="padding-left: 1em;">
                                  - {{ c.name }}
                                  <div *ngIf="c.children.length > 0">
                                    <div *ngFor="let l of c.children" style="padding-left: 2em;">
                                      - {{ l.name }}
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <br>
                            </div>
                          </li>
                        </div>
                      </div>
                    </ul>
                    <ul *ngIf="currentTreeNode.data.depth == 1">
                      <div *ngFor="let sp of allStudyPrograms; index as i">
                        <div *ngFor="let m of sp.children; index as j">
                          <div *ngFor="let c of (m.children | filter:filterText); index as k">
                            <li>
                              <h5 class="card-title">{{ c.name }}</h5>
                              <h6 class="text-muted inline">{{ c.numSemester }} semester</h6>
                              <h6 class="text-muted inline"> - {{ sp.affiliation }}</h6>
                              <a (click)="addExistingToStudyProgram(c)" class="inline">Add</a>
                              <div *ngIf="!(showMoreIndexM == j && showMoreIndexSP == i && showMoreIndexC == k)">
                                <a (click)="showMoreIndexM = j; showMoreIndexSP = i; showMoreIndexC = k"
                                  class="inline">Show more...</a>
                              </div>
                              <div *ngIf="showMoreIndexM == j && showMoreIndexSP == i && showMoreIndexC == k">
                                <a (click)="showMoreIndexM = -1; showMoreIndexSP = -1; showMoreIndexC = -1"
                                  class="inline">Show less...</a>
                                <p class="card-text">{{ c.description }}</p>
                                <div *ngIf="c.children.length > 0">
                                  <b>Child nodes that will also be included: </b>
                                  <div *ngFor="let l of c.children" style="padding-left: 1em;">
                                    - {{ l.name }}
                                  </div>
                                </div>
                              </div>
                              <br>
                            </li>
                          </div>
                        </div>
                      </div>
                    </ul>
                    <ul *ngIf="currentTreeNode.data.depth == 2">
                      <div *ngFor="let sp of allStudyPrograms; index as i">
                        <div *ngFor="let m of sp.children; index as j">
                          <div *ngFor="let c of m.children; index as k">
                            <div *ngFor="let l of (c.children | filter:filterText); index as m">
                              <li>
                                <h5 class="card-title">{{ l.name }}</h5>
                                <h6 class="text-muted inline">{{ l.ects }} ects</h6>
                                <h6 class="text-muted inline"> - {{ sp.affiliation }}</h6>
                                <a (click)="addExistingToStudyProgram(l)" class="inline">Add</a>
                                <div
                                  *ngIf="!(showMoreIndexM == j && showMoreIndexSP == i && showMoreIndexC == k && showMoreIndexL == m)">
                                  <a (click)="showMoreIndexM = j; showMoreIndexSP = i; showMoreIndexC = k; showMoreIndexL = m"
                                    class="inline">Show more...</a>
                                </div>
                                <div
                                  *ngIf="showMoreIndexM == j && showMoreIndexSP == i && showMoreIndexC == k && showMoreIndexL == m">
                                  <a (click)="showMoreIndexM = -1; showMoreIndexSP = -1; showMoreIndexC = -1; showMoreIndexL = -1"
                                    class="inline">Show less...</a>
                                  <p class="card-text">{{ c.description }}</p>
                                </div>
                              </li>
                            </div>
                          </div>
                        </div>
                      </div>
                    </ul>
                    <!-- 
                      <div class="row">
                      <div *ngFor="let m of allModules; index as i">
                        <div *ngIf="i < 10">
                          <div class="col-sm-6">
                            <div class="card" style="width: 18rem;">
                              <div class="card-body">
                                <h5 class="card-title">{{ m.name }}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">{{ m.numSemester }} semester</h6>
                                <p class="card-text">{{ m.description }}</p>
                                <a (click)="addExistingToStudyProgram(m)" class="card-link">Add/a>
                                <a href="#" class="card-link">Show more</a>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div> 
                  -->
                    <!--   <app-cmodules></app-cmodules> -->
                  </div>
                </div>
              </div>

            </div> <!-- </div> if currentTreeNode -->
            <div *ngIf="!currentTreeNode" class="col-md-6">
              To start creating your curricula create the highest item. After that, click on any item to add lower level
              items.

            </div> <!-- </div> if !currentTreeNode -->

          </div>

        </div>
      </div>
    </div>
    <!--/.col-->
  </div>
  <!--/.row-->
</div>

<div bsModal #bokModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-info modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Link BoK content to your study program.</h4>
        <button type="button" class="close" (click)="bokModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <!-- Search Knowledge and skills card  [hidden]="!isDisplayBoK" -->
        <div class="card card-accent-secondary">
          <div class="card-header">
            Body of Knowledge - Search knowledge and skills
            <span
              tooltip="Browse in the BoK for knowledge required for your new occupational profile. Once in the required knowledge, press the button 'Add' it will link the concept and the learning outcomes dependent on it."
              class="badge badge-primary badge-pill">i</span>
          </div>
          <div class="card-body" style="background-color: #faf9f8">
            <div class="row text-center">
              <div class="col-lg-4 col-sm-6">
                <div class="row text-center">
                  <div class="col-md-12">
                    <div class="input-group">
                      <div class="input-group-prepend" dropdown>
                        <button type="button" class="btn btn-primary">
                          <i class="fa fa-search"></i>
                        </button>
                      </div>
                      <input #searchInput type="text" id="input-competence-filter" name="input-competence-filter"
                        class="form-control" (keyup)="searchInBok(searchInput.value)" placeholder="Search Knowledge" />
                    </div>
                  </div>
                </div>
                <div id="bubbles">
                </div>
              </div>
              <div class="col-lg-8 col-sm-6 text-justify">
                <!--     <div class="row text-center">
                  <div class="col-sm-3">
                    Select attributes to link:
                  </div>
                  <div class="col-md-6" style="display: inline-flex">
                    <span class="input-group-prepend">
                      <label class="switch switch-label switch-pill switch-outline-primary-alt">
                        <input class="switch-input" type="checkbox" value="title" (checked)="switchTitle"
                          [(ngModel)]="switchTitle" />
                        <span class="switch-slider" data-checked="✓" data-unchecked="X"></span>
                      </label>
                      <div class="pl-1 pr-2">Title</div>
                    </span>
                    <span class="input-group-prepend">
                      <label class="switch switch-label switch-pill switch-outline-primary-alt">
                        <input class="switch-input" type="checkbox" value="description" (checked)="switchDescription"
                          [(ngModel)]="switchDescription" />
                        <span class="switch-slider" data-checked="✓" data-unchecked="X"></span>
                      </label>
                      <div class="pl-1 pr-2">Description</div>
                    </span>
                    <span class="input-group-prepend">
                      <label class="switch switch-label switch-pill switch-outline-primary-alt">
                        <input class="switch-input" type="checkbox" value="prerequisites" (checked)="switchPre"
                          [disabled]="currentTreeNode.depth!=2" [(ngModel)]="switchPre" />
                        <span class="switch-slider" data-checked="✓" data-unchecked="X"></span>
                      </label>
                      <div class="pl-1 pr-2">Prerequisites</div>
                    </span>
                    <span class="input-group-prepend">
                      <label class="switch switch-label switch-pill switch-outline-primary-alt">
                        <input class="switch-input" type="checkbox" value="learningObjectives" (checked)="switchLO"
                          [disabled]="currentTreeNode.depth!=3" [(ngModel)]="switchLO" />
                        <span class="switch-slider" data-checked="✓" data-unchecked="X"></span>
                      </label>
                      <div class="pl-1 pr-2">Learning Outcomes</div>
                    </span>
                  </div>
                  <div class="col-sm-3">
                    <button type="submit" class="btn btn-primary"
                      tooltip="Search or navigate in the graph to add knowledge." (click)="addBokKnowledge()">
                      Link this concept <i class="fa fa-arrow-up"></i>
                    </button>
                  </div>
                </div> -->
                <a [hidden]="currentConcept != ''" (click)="navigateToConcept('GIST')">
                  < Back </a>
                    <div #textBoK id="textBoK" [hidden]="currentConcept == '' && currentConcept != 'GIST'">
                    </div>
                    <div class="col" *ngIf="hasResults">
                      <h3 class="center">
                        {{ selectedNodes.length }} result(s) for
                        {{ searchInput.value }}
                      </h3>
                      <div *ngFor="let item of selectedNodes; index as i">
                        <div *ngIf="i < limitSearch">
                          <div class="inline">{{ item.nameShort }}</div>
                          <div class="inline" [innerHTML]="
                                      item.name | truncate: 100:searchInput.value
                                    "></div>
                          <a class="inline" (click)="navigateToConcept(item.nameShort)">
                            Details
                          </a>
                          <div class="small" [innerHTML]="item.description | truncate: 100:searchInput.value"></div>
                        </div>
                      </div>
                      <div>
                        <br />
                        <a *ngIf="limitSearch < selectedNodes.length" (click)="incrementLimit()">
                          Show more ...
                        </a>
                      </div>
                    </div>
              </div>
            </div>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="addBokKnowledge()">Link</button>
        <button type="button" class="btn btn-danger" (click)="bokModal.hide()">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->