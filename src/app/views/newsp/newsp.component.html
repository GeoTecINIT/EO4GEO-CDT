<div class="animated fadeIn">
  <h1 class="title">{{ title }}</h1>
  <div class="row">
    <div class="col-sm-12 col-md-12">
      <div class="card card-accent-primary">
        <div class="card-header">
          <div class="row">
            <div class="col-md-12 text-center mb-3">
              <div class="btn-group" dropdown>
                <button id="button-animated" dropdownToggle type="button"
                  class="btn btn-pill btn-primary dropdown-toggle" aria-controls="dropdown-animated">
                  <i class="fa fa-plus"></i> Create new <span class="caret"></span>
                </button>
                <ul id="dropdown-animated" *dropdownMenu class="dropdown-menu" role="menu"
                  aria-labelledby="button-animated">
                  <li role="menuitem"><a class="dropdown-item pt-2 pb-2"
                      [ngClass]="{'disabled': currentTreeNode && currentTreeNode.data.depth>=0}"
                      (click)="addNodeInTree(0)">Study
                      Program</a></li>
                  <li role="menuitem"><a class="dropdown-item pt-2 pb-2"
                      [ngClass]="{'disabled': currentTreeNode && currentTreeNode.data.depth>=1}"
                      (click)="addNodeInTree(1)">Module</a></li>
                  <li role="menuitem"><a class="dropdown-item pt-2 pb-2"
                      [ngClass]="{'disabled': currentTreeNode && currentTreeNode.data.depth>=2}"
                      (click)="addNodeInTree(2)">Course</a></li>
                  <li role="menuitem"><a class="dropdown-item pt-2 pb-2"
                      [ngClass]="{'disabled': currentTreeNode && currentTreeNode.data.depth>=3}"
                      (click)="addNodeInTree(3)">Lecture</a>
                  </li>
                </ul>
              </div>

              <button type="submit" class="btn btn-pill btn-primary"
                (click)="isSearchingExisting = !isSearchingExisting; isSearchingSpecific = false"
                [hidden]="!currentTreeNode || currentTreeNode.data.depth == 3">
                <i class="fa fa-search"></i> Explore existing learning content
                <!-- {{textByDepth}}s -->
              </button>
              <button type="submit" class="btn btn-pill btn-danger" (click)="removeNodeInTree()"
                [hidden]="!currentTreeNode || currentTreeNode.parent == null">
                <i class="fa fa-minus"></i> Remove {{textByDepthRemove}}
              </button>
            </div>
          </div>

          <div class="row" [hidden]="!currentTreeNode">
            <div class="col-sm-6 col-md-2">
              <p *ngIf="userOrgs.length > 0" class="text-primary text-right">Save under organization </p>
            </div>
            <div class="col-sm-6 col-md-3">
              <ng-select *ngIf="userOrgs.length > 0 && userOrgs.length == currentUser.organizations.length"
                [items]="userOrgs" name="userOrgs" bindLabel="name" [multiple]="false" [(ngModel)]="saveOrg"
                (change)="isSaved = false">
                <ng-template ng-optgroup-tmp let-item="item">
                  {{item.name}}
                </ng-template>
              </ng-select>
              <button *ngIf="userOrgs.length == 0" type="button" class="btn btn-block btn-link text-secondary"
                routerLink="/organization">
                &nbsp;You need to join or create an organization before you can save an occupational profile.
              </button>
            </div>
            <div class="col-sm-6 col-md-3" style="display: inline-flex" [hidden]="!currentTreeNode">
              <span class="input-group-prepend">
                <div class="pr-1"> Visibility: Private </div>
                <label class="switch switch-label switch-pill switch-outline-primary-alt">
                  <input *ngIf="model" class="switch-input" type="checkbox" [(ngModel)]="model.levelPublic"
                    (change)="isSaved = false" name="levelPublic" />
                  <span class="switch-slider" data-checked="✓" data-unchecked="X"></span>
                </label>
                <div class="pl-1">Public</div>
              </span>
              <span style="display:inline-table; margin:2px"
                tooltip="If visibility is private, users in this organization can still see it. But users not logged in won't be able to see it. Visibility by default is public."
                class="badge badge-primary badge-pill">i</span>
            </div>
            <div class="col-sm-6 col-md-4 text-right">
              <!-- <div>{{textSaved}}</div>-->
              <button type="submit" class="btn btn-pill btn-primary" (click)="saveStudyProgram()"
                [hidden]="!currentTreeNode" [ngClass]="{'success': isSaved}">
                <i class="fa fa-save"></i> Save
              </button>
              <button type="submit" class="btn btn-pill btn-primary" (click)="saveStudyProgram()" routerLink="/list"
                [hidden]="!currentTreeNode">
                <i class="icon-home"></i> Save and Exit
              </button>
            </div>
          </div>


        </div>
        <!-- card body -->
        <div class="card-body">
          <div class="row" (window:resize)="onResize()">
            <div class="col-md-6" #graphTreeDiv (click)="refreshCurrentNode()" [hidden]="!currentTreeNode">
              <div class="card card-accent-secondary">
                <div class="card-header">
                  <label>General view</label>
                  <span tooltip="Click on any node to see more information about the module, course or lecture."
                    class="badge badge-primary badge-pill">i</span>
                  <button class="btn btn-link float-right pull-right"
                    (click)="graphTreeDiv.classList.contains('col-md-12') ? graphTreeDiv.className = 'col-md-6' : graphTreeDiv.className = 'col-md-12'; refreshTreeSize()">
                    <i class="float-right pull-right fa "
                      [ngClass]="{'fa-window-minimize': graphTreeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': graphTreeDiv?.classList.contains('col-md-6')}"></i>
                  </button>
                  <div id="graphTree"></div>
                </div>
              </div>
            </div>
            <div *ngIf="currentTreeNode && (model || modelModule || modelCourse || modelLecture)" class="col-md-6"
              #NodeDiv>
              <!-- depth = 0 -> general info card -->
              <div *ngIf="!isSearchingExisting && currentTreeNode.data.depth == 0 && !isSearchingSpecific">
                <!--               <form #newOPForm="ngForm"> -->
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    Study Program Information
                    <span
                      tooltip="Fill in here your Study Program information. To link BoK concepts to your content click on the link BoK buttons."
                      class="badge badge-primary badge-pill">i</span>
                    <button class="btn btn-link float-right pull-right"
                      (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                      <i class="float-right pull-right fa "
                        [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                    </button>
                  </div>
                  <div class="card-body" style="background-color: #faf9f8">
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Title</label>
                          <input type="text" class="form-control" id="title" placeholder="Title"
                            [(ngModel)]="model.name" name="title" required (keyup)="updateTreeStudyProgram()" />
                          <div *ngIf="model.linksToBok.length > 0" style="display: flex;">
                            <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                            <div *ngFor="let l of model.linksToBok; index as i ">
                              <p class="text-small" *ngIf="l.linkedTo=='name'">{{l.concept_id }} <button type="button"
                                  class="btn btn-link btn-xs" (click)="removeBokKnowledge(model, i, 'linksToBok')">
                                  <i class="fa fa-remove"></i>
                                </button></p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="bokModal.show(); linkBoKto='name'">
                          Link BoK title
                        </button>
                      </div>

                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Affiliation</label>
                          <input type="text" class="form-control" id="affiliation" placeholder="Affiliation"
                            [(ngModel)]="model.affiliation" name="affiliation" required
                            (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-2">
                        <div class="form-group">
                          <label for="eqf">EQF</label>
                          <span
                            tooltip="The core of the EQF concerns eight reference levels describing what a learner knows, understands and is able to do – 'learning outcomes', ranging from basic (Level 1) to advanced (Level 8)."
                            class="badge badge-primary badge-pill">i</span>
                          <input type="number" size="1" class="form-control" id="eqf" [(ngModel)]="model.eqf" name="eqf"
                            min="1" max="8" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-9">
                        <div class="form-group">
                          <label for="field">Field of study</label>
                          <span
                            tooltip="The term relates directly to a specific area of study. The International Standard Classification of Education: Fields of Education and Training 2013 (ISCED-F). Maintained by the UNESCO Institute for Statistics."
                            class="badge badge-primary badge-pill">i</span>
                          <ng-select [items]="fieldsService.allfields" name="field" bindLabel="name"
                            groupBy="grandparent" [multiple]="false" [(ngModel)]="model.field">
                            <ng-template ng-optgroup-tmp let-item="item">
                              {{item.grandparent || 'Unnamed group'}}
                            </ng-template>
                          </ng-select>
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="form-group">
                          <label for="numSemesters">Amount of semesters</label>
                          <span tooltip="Number of semesters in the curricula."
                            class="badge badge-primary badge-pill">i</span>
                          <input type="text" size="10" class="form-control" id="numSemesters"
                            [(ngModel)]="model.numSemesters" name="numSemesters" min="1" max="20"
                            (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="description">Description</label>
                          <textarea class="form-control" id="description" name="description"
                            placeholder="Add a short introduction and other information relevant to the study program..."
                            [(ngModel)]="model.description" rows="4" (keyup)="updateTreeStudyProgram()"></textarea>
                          <div *ngIf="model.linksToBok.length > 0" style="display: flex;">
                            <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                            <div *ngFor="let l of model.linksToBok; index as i ">
                              <p class="text-small" *ngIf="l.linkedTo=='description'">{{l.concept_id }} <button
                                  type="button" class="btn btn-link btn-xs"
                                  (click)="removeBokKnowledge(model, i, 'linksToBok')">
                                  <i class="fa fa-remove"></i>
                                </button></p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="bokModal.show(); linkBoKto='description'">
                          Link BoK description
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--   </form> -->
              <!-- depth = 1 -> Modules -->
              <div *ngIf="!isSearchingExisting && currentTreeNode.data.depth == 1 && !isSearchingSpecific">
                <!-- <form #newOPForm="ngForm"> -->
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    Module Information
                    <span
                      tooltip="Fill in here your Module information. To link BoK concepts to your content click on the link BoK buttons."
                      class="badge badge-primary badge-pill">i</span>
                    <button class="btn btn-link float-right pull-right"
                      (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                      <i class="float-right pull-right fa "
                        [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                    </button>
                  </div>
                  <div class="card-body" style="background-color: #faf9f8">
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Title</label>
                          <input type="text" class="form-control" id="title" placeholder="Title"
                            [(ngModel)]="modelModule.name" name="title" required (keyup)="updateTreeStudyProgram()" />
                          <div *ngIf="modelModule.linksToBok.length > 0" style="display: flex;">
                            <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                            <div *ngFor="let l of modelModule.linksToBok; index as i ">
                              <p class="text-small" *ngIf="l.linkedTo=='name'">{{l.concept_id }} <button type="button"
                                  class="btn btn-link btn-xs"
                                  (click)="removeBokKnowledge(modelModule, i, 'linksToBok')">
                                  <i class="fa fa-remove"></i>
                                </button></p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="bokModal.show(); linkBoKto='name'">
                          Link BoK title
                        </button>
                      </div>
                    </div>
                    <div class="row" *ngIf="highestItemLevel == 1">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Affiliation</label>
                          <input type="text" class="form-control" id="affiliation" placeholder="Affiliation"
                            [(ngModel)]="modelModule.affiliation" name="affiliation" required
                            (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-2">
                        <div class="form-group">
                          <label for="eqf">EQF</label>
                          <span
                            tooltip="The core of the EQF concerns eight reference levels describing what a learner knows, understands and is able to do – 'learning outcomes', ranging from basic (Level 1) to advanced (Level 8)."
                            class="badge badge-primary badge-pill">i</span>
                          <input type="number" size="1" class="form-control" id="eqf" [(ngModel)]="modelModule.eqf"
                            name="eqf" min="1" max="8" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="numSemester">Number of semester</label>
                          <span tooltip="In which semester is taught." class="badge badge-primary badge-pill">i</span>
                          <input type="text" size="10" class="form-control" id="numSemester"
                            [(ngModel)]="modelModule.numSemester" name="numSemester" min="1" max="15"
                            (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="ects">ECTS</label>
                          <span
                            tooltip="European Credit Transfer and Accumulation System (ECTS) is a standard means for comparing academic credits for higher education. One academic year corresponds to 60 ECTS credits that are normally equivalent to 1500–1800 hours of total workload."
                            class="badge badge-primary badge-pill">i</span>
                          <input type="number" class="form-control" id="ects" [(ngModel)]="modelModule.ects" name="ects"
                            min="0" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="description">Description</label>
                          <textarea class="form-control" id="description" name="description"
                            [(ngModel)]="modelModule.description" rows="4"
                            placeholder="Add a short introduction and other information relevant to the module..."
                            (keyup)="updateTreeStudyProgram()"></textarea>
                          <div *ngIf="modelModule.linksToBok.length > 0" style="display: flex;">
                            <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                            <div *ngFor="let l of modelModule.linksToBok; index as i ">
                              <p class="text-small" *ngIf="l.linkedTo=='description'">{{l.concept_id }} <button
                                  type="button" class="btn btn-link btn-xs"
                                  (click)="removeBokKnowledge(modelModule, i, 'linksToBok')">
                                  <i class="fa fa-remove"></i>
                                </button></p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="bokModal.show(); linkBoKto='description'">
                          Link BoK description
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="prerequisites">Prerequisites</label>
                          <div class="col-md-12">
                            <div *ngIf="modelModule && modelModule.prerequisites">
                              <ul>
                                <div *ngFor="let p of modelModule.prerequisites; index as i ">
                                  <li>{{p.concept_id}} <button type="button" class="btn btn-link"
                                      (click)="removeBokKnowledge(modelModule, i, 'prerequisites')">
                                      <i class="fa fa-remove"></i>
                                    </button></li>
                                </div>
                              </ul>
                            </div>
                            <div *ngIf="!modelModule.prerequisites || modelModule.prerequisites.length == 0"
                              class="text-placeholder">
                              Explore the Body of Knowledge to add some.
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="bokModal.show(); linkBoKto='prerequisites'">
                          Link BoK prerequisite
                        </button>
                      </div>
                      <!--     <div class="col-md-12 align-middle m-auto">
                        <div *ngIf="modelModule.linksToBok.length" style="display: flex;">
                          <div *ngFor="let l of modelModule.linksToBok; index as i ">
                            <p class="text-small" *ngIf="l.linkedTo=='prerequisites'">{{l.concept_id }} <button
                                type="button" class="btn btn-link btn-sm"
                                (click)="removeBokKnowledge(modelModule, i, 'linksToBok')">
                                <i class="fa fa-remove"></i>
                              </button></p>
                          </div>
                        </div>
                      </div> -->
                    </div>
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Learning Outcomes</label>
                          <div class="row">
                            <div class="col-md-12">
                              <div *ngIf="modelModule && modelModule.learningObjectives">
                                <ul>
                                  <div *ngFor="let p of modelModule.learningObjectives; index as i ">
                                    <li>{{p.name}}
                                      <!-- <button type="button" class="btn btn-link"
                                        (click)="removeBokKnowledge(modelModule, i, 'learningObjectives')">
                                        <i class="fa fa-remove"></i>
                                      </button> -->
                                    </li>
                                  </div>
                                </ul>
                              </div>
                              <div *ngIf="!modelModule.learningObjectives || modelModule.learningObjectives.length == 0"
                                class="text-placeholder">
                                Add some courses and explore BoK to add some.
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm" disabled>
                          Inherited from child courses
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <!--   </form> -->
              </div>
              <!-- depth = 2 -> Course -->
              <div *ngIf="!isSearchingExisting && currentTreeNode.data.depth == 2 && !isSearchingSpecific">
                <!-- <form #newOPForm="ngForm"> -->
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    Course Information
                    <span
                      tooltip="Fill in here your Course information. To link BoK concepts to your content click on the link BoK buttons."
                      class="badge badge-primary badge-pill">i</span>
                    <button class="btn btn-link float-right pull-right"
                      (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                      <i class="float-right pull-right fa "
                        [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                    </button>
                  </div>
                  <div class="card-body" style="background-color: #faf9f8">
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Title</label>
                          <input type="text" class="form-control" id="title" placeholder="Title"
                            [(ngModel)]="modelCourse.name" name="title" required (keyup)="updateTreeStudyProgram()" />
                          <div *ngIf="modelCourse.linksToBok.length > 0" style="display: flex;">
                            <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                            <div *ngFor="let l of modelCourse.linksToBok; index as i ">
                              <p class="text-small" *ngIf="l.linkedTo=='name'">{{l.concept_id }} <button type="button"
                                  class="btn btn-link btn-xs"
                                  (click)="removeBokKnowledge(modelCourse, i, 'linksToBok')">
                                  <i class="fa fa-remove"></i>
                                </button></p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="bokModal.show(); linkBoKto='name'">
                          Link BoK title
                        </button>
                      </div>
                    </div>
                    <div class="row" *ngIf="highestItemLevel == 2">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Affiliation</label>
                          <input type="text" class="form-control" id="affiliation" placeholder="Affiliation"
                            [(ngModel)]="modelCourse.affiliation" name="affiliation" required
                            (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-2">
                        <div class="form-group">
                          <label for="eqf">EQF</label>
                          <span
                            tooltip="The core of the EQF concerns eight reference levels describing what a learner knows, understands and is able to do – 'learning outcomes', ranging from basic (Level 1) to advanced (Level 8)."
                            class="badge badge-primary badge-pill">i</span>
                          <input type="number" size="1" class="form-control" id="eqf" [(ngModel)]="modelCourse.eqf"
                            name="eqf" min="1" max="8" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="eqf">Type</label>
                          <span tooltip="Specify course type if needed." class="badge badge-primary badge-pill">i</span>
                          <select [(ngModel)]="modelCourse.type" (change)="isSaved = false">
                            <option value=""></option>
                            <option value="Common">Common</option>
                            <option value="Specialization">Specialization</option>
                            <option value="Elective">Elective</option>
                          </select>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="description">Description</label>
                          <textarea class="form-control" id="description" placeholder="Description" name="description"
                            [(ngModel)]="modelCourse.description" (keyup)="updateTreeStudyProgram()" rows="4"
                            placeholder="Add a short introduction and other information relevant to the course..."></textarea>
                          <div *ngIf="modelCourse.linksToBok.length > 0" style="display: flex;">
                            <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                            <div *ngFor="let l of modelCourse.linksToBok; index as i ">
                              <p class="text-small" *ngIf="l.linkedTo=='description'">{{l.concept_id }} <button
                                  type="button" class="btn btn-link btn-xs"
                                  (click)="removeBokKnowledge(modelCourse, i, 'linksToBok')">
                                  <i class="fa fa-remove"></i>
                                </button></p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="bokModal.show(); linkBoKto='description'">
                          Link BoK description
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Prerequisites</label>
                          <div class="row">
                            <div class="col-md-12">
                              <div *ngIf="modelCourse && modelCourse.prerequisites">
                                <ul>
                                  <div *ngFor="let p of modelCourse.prerequisites; index as i ">
                                    <li>{{p.concept_id}} <button type="button" class="btn btn-link"
                                        (click)="removeBokKnowledge(modelCourse, i, 'prerequisites')">
                                        <i class="fa fa-remove"></i>
                                      </button></li>
                                  </div>
                                </ul>
                              </div>
                              <div *ngIf="!modelCourse.prerequisites || modelCourse.prerequisites.length == 0"
                                class="text-placeholder">
                                Explore the Body of Knowledge to add some.
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="bokModal.show(); linkBoKto='prerequisites'">
                          Link BoK prerequisite
                        </button>
                      </div>
                      <!-- <div *ngFor="let l of modelCourse.linksToBok; index as i ">
                        <p class="text-small" *ngIf="l.linkedTo=='prerequisites'">{{l.concept_id }} <button
                            type="button" class="btn btn-link btn-sm"
                            (click)="removeBokKnowledge(modelCourse, i, 'linksToBok')">
                            <i class="fa fa-remove"></i>
                          </button></p>
                      </div> -->
                    </div>
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Learning Outcomes</label>
                          <div class="row">
                            <div class="col-md-12">
                              <div *ngIf="modelCourse && modelCourse.learningObjectives">
                                <ul>
                                  <div *ngFor="let p of modelCourse.learningObjectives; index as i ">
                                    <li>{{p.name}} <button type="button" class="btn btn-link"
                                        (click)="removeBokKnowledge(modelCourse, i, 'learningObjectives')">
                                        <i class="fa fa-remove"></i>
                                      </button></li>
                                  </div>
                                </ul>
                              </div>
                              <div *ngIf="!modelCourse.learningObjectives || modelCourse.learningObjectives.length == 0"
                                class="text-placeholder">
                                Explore the Body of Knowledge to add some or add custom learning outcomes.
                              </div>
                              <div *ngIf="modelCourse.linksToBok.length > 0" style="display: flex;">
                                <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                                <div *ngFor="let l of modelCourse.linksToBok; index as i ">
                                  <p class="text-small" *ngIf="l.linkedTo=='learningObjectives'">{{l.concept_id }}
                                    <button type="button" class="btn btn-link btn-xs"
                                      (click)="removeBokKnowledge(modelCourse, i, 'linksToBok')">
                                      <i class="fa fa-remove"></i>
                                    </button></p>
                                </div>
                              </div>
                              <br>
                              <div class="row">
                                <div class="col-md-2"></div>
                                <div class="col-md-6">
                                  <input type="text" class="form-control" id="customLO"
                                    placeholder="Add custom learning outcome" [(ngModel)]="customLO" name="customLO" />
                                </div>
                                <div class="col-md-4">
                                  <button type="button" class="btn btn-primary btn-sm" (click)="addCustomLO()">
                                    Add custom LO
                                  </button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="bokModal.show(); linkBoKto='learningObjectives'">
                          Link BoK learning outcomes
                        </button>
                      </div>
                      <!--      <div *ngFor="let l of modelCourse.linksToBok; index as i ">
                        <p class="text-small" *ngIf="l.linkedTo=='learningObjectives'">{{l.concept_id }} <button
                            type="button" class="btn btn-link btn-sm"
                            (click)="removeBokKnowledge(modelCourse, i, 'linksToBok')">
                            <i class="fa fa-remove"></i>
                          </button></p>
                      </div> -->
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="ects">ECTS</label>
                          <span
                            tooltip="European Credit Transfer and Accumulation System (ECTS) is a standard means for comparing academic credits for higher education. One academic year corresponds to 60 ECTS credits that are normally equivalent to 1500–1800 hours of total workload."
                            class="badge badge-primary badge-pill">i</span>
                          <input type="number" class="form-control" name="ects" id="ects" [(ngModel)]="modelCourse.ects"
                            name="ects" min="0" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="numSemester">Number of semester</label>
                          <span tooltip="In which semester is taught." class="badge badge-primary badge-pill">i</span>
                          <input type="text" size="10" class="form-control" id="numSemester"
                            [(ngModel)]="modelCourse.numSemester" name="numSemester" min="1" max="999"
                            (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="assessment">Assessment</label>
                          <span tooltip="Describe how the course will be assessed."
                            class="badge badge-primary badge-pill">i</span>
                          <input type="text" class="form-control" id="assessment" placeholder="Assessment"
                            [(ngModel)]="modelCourse.assessment" name="assessment" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="bibliography">Bibliography</label>
                          <span
                            tooltip="APA style. Example: Walford, N. (2002). Geographical data: Characteristics and sources. Chilchester: Wiley. ISBN: 9780471970859. DOI: https://doi.org/10.1046/j.0031-868X.2003.024_03.x"
                            class="badge badge-primary badge-pill">i</span>
                          <div class="row">
                            <div class="col-md-12">
                              <div *ngIf="modelCourse && modelCourse.bibliography">
                                <ul>
                                  <div *ngFor="let b of modelCourse.bibliography; index as i ">
                                    <li>{{b.name}} <button type="button" class="btn btn-link"
                                        (click)="removeBokKnowledge(modelCourse, i, 'bibliography')">
                                        <i class="fa fa-remove"></i>
                                      </button></li>
                                  </div>
                                </ul>
                              </div>
                              <div *ngIf="!modelCourse.bibliography || modelCourse.bibliography.length == 0"
                                class="text-placeholder">
                                Explore the Body of Knowledge to add some bibliography or add your own.
                              </div>
                              <div *ngIf="modelCourse.linksToBok.length > 0" style="display: flex;">
                                <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                                <div *ngFor="let l of modelCourse.linksToBok; index as i ">
                                  <p class="text-small" *ngIf="l.linkedTo=='bibliography'">{{l.concept_id }}
                                    <button type="button" class="btn btn-link btn-xs"
                                      (click)="removeBokKnowledge(modelCourse, i, 'bibliography')">
                                      <i class="fa fa-remove"></i>
                                    </button></p>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-8">
                              <input type="text" class="form-control" id="bibliography" placeholder="Bibliography"
                                [(ngModel)]="customBib" name="bibliography" />
                            </div>
                            <div class="col-md-4">
                              <button type="button" class="btn btn-primary btn-sm" (click)="addCustomBib(modelCourse)">
                                Add custom Bibliography
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="bokModal.show(); linkBoKto='bibliography'">
                          Link BoK bibliography
                        </button>
                      </div>

                    </div>
                  </div>
                </div>
              </div>
              <!--   </form> -->

              <!-- depth = 3 -> Lectures -->
              <div *ngIf="!isSearchingExisting && currentTreeNode.data.depth == 3 && !isSearchingSpecific">
                <!-- <form #newOPForm="ngForm"> -->
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    Lecture Information
                    <span
                      tooltip="Fill in here your Lecture information. To link BoK concepts to your content click on the link BoK buttons."
                      class="badge badge-primary badge-pill">i</span>
                    <button class="btn btn-link float-right pull-right"
                      (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                      <i class="float-right pull-right fa "
                        [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                    </button>
                  </div>
                  <div class="card-body" style="background-color: #faf9f8">
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Title</label>
                          <input type="text" class="form-control" id="title" placeholder="Title"
                            [(ngModel)]="modelLecture.name" name="title" required (keyup)="updateTreeStudyProgram()" />
                          <div *ngIf="modelLecture.linksToBok.length > 0" style="display: flex;">
                            <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                            <div *ngFor="let l of modelLecture.linksToBok; index as i ">
                              <p class="text-small" *ngIf="l.linkedTo=='name'">{{l.concept_id }} <button type="button"
                                  class="btn btn-link btn-xs"
                                  (click)="removeBokKnowledge(modelLecture, i, 'linksToBok')">
                                  <i class="fa fa-remove"></i>
                                </button></p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="bokModal.show(); linkBoKto='name'">
                          Link BoK title
                        </button>
                      </div>
                    </div>
                    <div class="row" *ngIf="highestItemLevel == 3">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="title">Affiliation</label>
                          <input type="text" class="form-control" id="affiliation" placeholder="Affiliation"
                            [(ngModel)]="modelLecture.affiliation" name="affiliation" required
                            (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-2">
                        <div class="form-group">
                          <label for="eqf">EQF</label>
                          <span
                            tooltip="The core of the EQF concerns eight reference levels describing what a learner knows, understands and is able to do – 'learning outcomes', ranging from basic (Level 1) to advanced (Level 8)."
                            class="badge badge-primary badge-pill">i</span>
                          <input type="number" size="1" class="form-control" id="eqf" [(ngModel)]="modelLecture.eqf"
                            name="eqf" min="1" max="8" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="description">Description</label>
                          <textarea class="form-control" id="description" name="description"
                            [(ngModel)]="modelLecture.description" rows="4"
                            placeholder="Add a short introduction and other information relevant to the lecture..."
                            (keyup)="updateTreeStudyProgram()"></textarea>
                          <div *ngIf="modelLecture.linksToBok.length > 0" style="display: flex;">
                            <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                            <div *ngFor="let l of modelLecture.linksToBok; index as i ">
                              <p class="text-small" *ngIf="l.linkedTo=='description'">{{l.concept_id }} <button
                                  type="button" class="btn btn-link btn-xs"
                                  (click)="removeBokKnowledge(modelLecture, i, 'linksToBok')">
                                  <i class="fa fa-remove"></i>
                                </button></p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="bokModal.show(); linkBoKto='description'">
                          Link BoK description
                        </button>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="ects">ECTS</label>
                          <span
                            tooltip="European Credit Transfer and Accumulation System (ECTS) is a standard means for comparing academic credits for higher education. One academic year corresponds to 60 ECTS credits that are normally equivalent to 1500–1800 hours of total workload."
                            class="badge badge-primary badge-pill">i</span>
                          <input type="number" class="form-control" id="ects" [(ngModel)]="modelLecture.ects"
                            name="ects" min="0" (keyup)="updateTreeStudyProgram()" />
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="isPractical">Is practical</label>
                          <span tooltip="Check this option if it is a practical lecture."
                            class="badge badge-primary badge-pill">i</span>
                          <label class="switch switch-pill switch-primary">
                            <input type="checkbox" name="isPractical" class="switch-input"
                              [(ngModel)]="modelLecture.isPractical">
                            <span class="switch-slider"></span>
                          </label>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-10">
                        <div class="form-group">
                          <label for="bibliography">Bibliography</label>
                          <span
                            tooltip="APA style. Example: Walford, N. (2002). Geographical data: Characteristics and sources. Chilchester: Wiley. ISBN: 9780471970859. DOI: https://doi.org/10.1046/j.0031-868X.2003.024_03.x"
                            class="badge badge-primary badge-pill">i</span>
                          <div class="row">
                            <div class="col-md-12">
                              <div *ngIf="modelLecture && modelLecture.bibliography">
                                <ul>
                                  <div *ngFor="let b of modelLecture.bibliography; index as i ">
                                    <li>{{b.name}} <button type="button" class="btn btn-link"
                                        (click)="removeBokKnowledge(modelLecture, i, 'bibliography')">
                                        <i class="fa fa-remove"></i>
                                      </button></li>
                                  </div>
                                </ul>
                              </div>
                              <div *ngIf="!modelLecture.bibliography || modelLecture.bibliography.length == 0"
                                class="text-placeholder">
                                Explore the Body of Knowledge to add some bibliography or add your own.
                              </div>
                              <div *ngIf="modelLecture.linksToBok.length > 0" style="display: flex;">
                                <p class="text-small"> Linked BOK concept(s): &nbsp; </p>
                                <div *ngFor="let l of modelLecture.linksToBok; index as i ">
                                  <p class="text-small" *ngIf="l.linkedTo=='bibliography'">{{l.concept_id }}
                                    <button type="button" class="btn btn-link btn-xs"
                                      (click)="removeBokKnowledge(modelLecture, i, 'bibliography')">
                                      <i class="fa fa-remove"></i>
                                    </button></p>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-8">
                              <input type="text" class="form-control" id="bibliography" placeholder="Bibliography"
                                [(ngModel)]="customBib" name="bibliography" />
                            </div>
                            <div class="col-md-4">
                              <button type="button" class="btn btn-primary btn-sm" (click)="addCustomBib(modelLecture)">
                                Add custom Bibliography
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-2 align-middle m-auto">
                        <button type="button" class="btn btn-primary btn-sm"
                          (click)="bokModal.show(); linkBoKto='bibliography'">
                          Link BoK bibliography
                        </button>
                      </div>

                    </div>
                  </div>
                </div>
                <!--    </form> -->
              </div>

              <!-- Existing modules, courses and lectures -->
              <div *ngIf="isSearchingExisting && !isSearchingSpecific">
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    Explore existing learning content
                    <!--  {{textByDepth}}s -->
                    <span tooltip="These items have been added by other user, and can be re-used in your curricula."
                      class="badge badge-primary badge-pill">i</span>
                    <button class="btn btn-link float-right pull-right"
                      (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                      <i class="float-right pull-right fa "
                        [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                    </button>
                  </div>
                  <div class="card-body" style="background-color: #faf9f8">
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <div class="text-center">
                            <button class="btn btn-pill btn-outline-primary" [ngClass]="{'active': depthSearching==1}"
                              [disabled]="currentTreeNode.depth>0" [hidden]="highestItemLevel >= 1"
                              (click)="depthSearching=1">Modules</button>
                            <button class="btn btn-pill btn-outline-primary" [ngClass]="{'active': depthSearching==2}"
                              [disabled]="currentTreeNode.depth>1" [hidden]="highestItemLevel >= 2"
                              (click)="depthSearching=2">Courses</button>
                            <button class="btn btn-pill btn-outline-primary" [ngClass]="{'active': depthSearching==3}"
                              [disabled]="currentTreeNode.depth>2" [hidden]="highestItemLevel >= 3"
                              (click)="depthSearching=3">Lectures</button>
                            <button class="btn btn-link pull-right"
                              (click)="isSearchingExisting = !isSearchingExisting"><i class="fa fa-times"></i>
                              Close</button>
                          </div>
                          <br>
                          <label for="title">Filter items by name</label> <!-- {{textByDepth}}  -->
                          <input type="text" class="form-control" id="filterText" placeholder="Type to filter"
                            [(ngModel)]="filterText" name="filterText" />
                        </div>
                      </div>
                      <!-- <div class="col-md-6">
                      <div class="form-group">
                        <label for="title">Filter {{textByDepth}} by affiliation</label>
                        <input type="text" class="form-control" id="filterTextAff" placeholder="Type to filter"
                          [(ngModel)]="filterTextAff" name="filterTextAff" />
                      </div>
                    </div> -->
                    </div>
                    <ul>
                      <div *ngFor="let i of (allItems| filter:filterText); index as in">
                        <li *ngIf="i.depth==depthSearching"><a class="card-title"
                            (click)="showExistingToStudyProgram(i); isSearchingSpecific = !isSearchingSpecific; isSearchingExisting = !isSearchingExisting">{{ i.name }}</a>
                          <h6 *ngIf="i.field" class="text-muted inline"> - Field of study: {{ i.field.name }}</h6>
                          <h6 *ngIf="i.affiliation != ''" class="text-muted inline"> - {{ i.affiliation }}</h6>
                          <h6 *ngIf="i.eqf != 0" class="text-muted inline"> - EQF: {{ i.eqf }}</h6>
                        </li>
                      </div>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- Show specific existing module -->
              <div *ngIf="isSearchingSpecific && !isSearchingExisting">
                <div class="card card-accent-secondary">
                  <div class="card-header">
                    <h5>{{currentStudyProgram.name}}</h5>
                    <span tooltip="This item has been added by other user, and can be re-used in your curricula."
                      class="badge badge-primary badge-pill">i</span>
                    <button class="btn btn-link float-right pull-right"
                      (click)="NodeDiv.classList.contains('col-md-12') ? NodeDiv.className = 'col-md-6' : NodeDiv.className = 'col-md-12'">
                      <i class="float-right pull-right fa "
                        [ngClass]="{'fa-window-minimize': NodeDiv?.classList.contains('col-md-12'), 'fa-window-maximize': NodeDiv?.classList.contains('col-md-6')}"></i>
                    </button>
                  </div>
                  <div class="card-body" style="background-color: #faf9f8">
                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <button type="submit" class="btn btn-link"
                            (click)="isSearchingSpecific = false; isSearchingExisting = !isSearchingExisting">
                            <i class="fa fa-arrow-left"></i> Back
                          </button>
                          <h4 *ngIf="depthSearching==1"> Module: {{ currentStudyProgram.name }} </h4>
                          <h4 *ngIf="depthSearching==2"> Course: {{ currentStudyProgram.name }} </h4>
                          <h4 *ngIf="depthSearching==3"> Lecture: {{ currentStudyProgram.name }} </h4>
                          <p class="text-justify">{{ currentStudyProgram.description }}</p>

                          <div *ngIf="currentStudyProgram.numSemester">
                            <p><b> In semester:</b> {{ currentStudyProgram.numSemester }}</p>
                          </div>
                          <div *ngIf="currentStudyProgram.ects">
                            <p><b> ECTS:</b> {{ currentStudyProgram.ects }}</p>
                          </div>
                          <div *ngIf="currentStudyProgram.assessment">
                            <p><b>Assessment:</b> {{ currentStudyProgram.assessment }}</p>
                          </div>
                          <div *ngIf="currentStudyProgram.bibliography">
                            <p><b>Bibliography:</b> {{ currentStudyProgram.bibliography }}</p>
                          </div>
                          <div *ngIf="currentStudyProgram.sourceDocs">
                            <p><b>Bibliography:</b> {{ currentStudyProgram.sourceDocs }}</p>
                          </div>
                          <div
                            *ngIf="currentStudyProgram.prerequisites && currentStudyProgram.prerequisites.length > 0">
                            <span><b>Prerequisites</b></span>
                            <ul>
                              <div *ngFor="let p of currentStudyProgram.prerequisites">
                                <li>{{ p.name }}</li>
                              </div>
                            </ul>
                          </div>
                          <div
                            *ngIf="currentStudyProgram.learningObjectives && currentStudyProgram.learningObjectives.length > 0">
                            <span><b>Learning Outcomes:</b></span>
                            <ul>
                              <div *ngFor="let l of currentStudyProgram.learningObjectives">
                                <li>{{ l.name }}</li>
                              </div>
                            </ul>
                          </div>
                          <div *ngIf="currentStudyProgram.children && currentStudyProgram.children.length > 0">
                            <b>Child nodes that will also be included: </b>
                            <div *ngFor="let l of currentStudyProgram.children" style="padding-left: 1em;">
                              - {{ l.name }}
                            </div>
                          </div>
                          <button type="submit" class="btn btn-pill btn-primary pull-right"
                            (click)="addExistingToStudyProgram(currentStudyProgram)">
                            <i class="fa fa-plus"></i> Add to my curricula
                          </button>

                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="!currentTreeNode" class="col-md-12">
          <div class="card card-accent-secondary">
            <div class="card-header">
              <b>How to get started</b>

            </div>
            <div class="card-body" style="background-color: #faf9f8">
              <div class="row">
                <div class="col-md-12">

                  You can create any curriculum item (study program, module, course, lecture). To do so, create the high
                  level item first, then click on the desired level to
                  add lower level items.
                  <br><br>
                  The hierarchy is as follows:
                  <br><br>
                  &emsp; Study Program
                  <br>
                  &emsp; &emsp; Module
                  <br>
                  &emsp; &emsp; &emsp; Course
                  <br>
                  &emsp; &emsp; &emsp; &emsp; Lecture
                  <br><br>

                  Where:

                  <ul>
                    <li>A study program is a curriculum of two or more courses that is intended or understood to lead to
                      a degree, diploma, or certificate.
                    </li>
                    <li>A module is a collection of courses over a year or semester
                    </li>
                    <li>A course is a unit of teaching that typically lasts one academic term
                    </li>
                    <li>A lecture is a presentation intended to display information or teach people about a particular
                      subject (also known as lessons or classes)
                    </li>
                  </ul>
                  <br><br>
                  Examples:
                  <ul>
                    <li>
                      If you only need to create a Course and Lectures, start by creating a Course. If you require many
                      Courses, you can start with Study Program (and skip Modules) or start with Module.
                    </li>
                    <li>
                      If you want to define a complete study program, start by creating a Study Program, then add
                      Modules,
                      Courses and
                      Lectures as required.
                    </li>
                  </ul>
                  <br><br>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
    <!--/.col-->
  </div>
  <!--/.row-->
</div>

<div bsModal #bokModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-info modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Link BoK content to your study program.</h4>
        <button type="button" class="close" (click)="bokModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <!-- Search Knowledge and skills card  [hidden]="!isDisplayBoK" -->
        <div class="card card-accent-secondary">
          <div class="card-header">
            Body of Knowledge - Search knowledge and skills
            <span
              tooltip="Browse in the BoK for knowledge required for your new occupational profile. Once in the required knowledge, press the button 'Add' it will link the concept and the learning outcomes dependent on it."
              class="badge badge-primary badge-pill">i</span>
          </div>

          <div class="card-body" style="background-color: #faf9f8">
            <div class="row text-center">
              <div class="col-lg-4 col-sm-6">
                <div class="row text-center">
                  <div class="col-md-12">
                    <div class="input-group">
                      <div class="input-group-prepend" dropdown>
                        <button type="button" class="btn btn-primary">
                          <i class="fa fa-search"></i>
                        </button>
                      </div>
                      <input #searchInput type="text" id="input-competence-filter" name="input-competence-filter"
                        class="form-control" (keyup)="searchInBok(searchInput.value)" placeholder="Search Knowledge" />
                    </div>
                  </div>
                </div>
                <div id="bubbles">
                </div>
              </div>
              <div class="col-lg-8 col-sm-6 text-justify">

                <a (click)="navigateToConcept('GIST')" *ngIf="!(!hasResults && currentConcept != 'GIST')">
                  < To full BoK </a>
                    <a (click)="hasResults = !hasResults; currentConcept=''"
                      *ngIf="!hasResults && currentConcept != 'GIST'">
                      < Back to results </a> <br>
                        <h5 [hidden]="currentConcept == '' && currentConcept != 'GIST'">Knowledge</h5>
                        <div #textBoK id="textBoK" [hidden]="currentConcept == '' && currentConcept != 'GIST'">
                        </div>
                        <div class="col" *ngIf="hasResults">
                          <h3 class="center">
                            {{ selectedNodes.length }} result(s) for
                            {{ searchInput.value }}
                          </h3>
                          <div *ngFor="let item of selectedNodes; index as i">
                            <div *ngIf="i < limitSearch">
                              <div class="inline">{{ item.nameShort }}</div>
                              <div class="inline" [innerHTML]="
                            item.name | truncate: 100:searchInput.value
                          "></div>
                              <a class="inline" (click)="navigateToConcept(item.nameShort)">
                                Details
                              </a>
                              <div class="small" [innerHTML]="
                            item.description | truncate: 100:searchInput.value
                          "></div>
                            </div>
                          </div>
                          <div>
                            <br />
                            <a *ngIf="limitSearch < selectedNodes.length" (click)="incrementLimit()">
                              Show more ...
                            </a>
                          </div>
                        </div>

              </div>
            </div>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="addBokKnowledge()">Link</button>
        <button type="button" class="btn btn-danger" (click)="bokModal.hide()">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->